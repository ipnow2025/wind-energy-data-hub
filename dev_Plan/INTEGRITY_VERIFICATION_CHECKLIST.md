# 파일 무결성 검증 기능 체크리스트

## 구현 완료 사항

### ✅ 1. 파일 업로드 시 SHA256 해시 계산
- **위치**: `app/api/collaboration/upload/route.ts`
- **기능**: 파일 업로드 시 자동으로 SHA256 해시값 계산
- **확인 방법**: 
  - 파일 업로드 후 응답에 `sha256` 필드가 포함되는지 확인
  - 콘솔 로그에서 "File SHA256 hash calculated" 메시지 확인

### ✅ 2. 해시값 데이터베이스 저장
- **위치**: 모든 파일 업로드/편집 페이지
- **기능**: 파일 정보와 함께 SHA256 해시값을 데이터베이스에 저장
- **수정된 파일**:
  - `app/admin/knowledge/new/page.tsx` ✅
  - `app/admin/collaboration/new/page.tsx` ✅
  - `app/collaboration/new/page.tsx` ✅
  - Edit 페이지들은 `allFiles`를 직접 사용하므로 자동 포함됨

### ✅ 3. 파일 목록에 해시값 표시
- **위치**: 모든 게시글 상세 페이지
- **기능**: 
  - SHA256 해시값 텍스트 표시
  - 해시값 복사 버튼
  - .sha256 파일 다운로드 링크
- **수정된 파일**:
  - `app/knowledge/[id]/page.tsx` ✅
  - `app/collaboration/post/[id]/page.tsx` ✅
  - `app/admin/collaboration/post/[id]/page.tsx` ✅
  - `app/admin/knowledge/post/[id]/page.tsx` ✅

### ✅ 4. .sha256 파일 자동 생성 API
- **위치**: `app/api/files/sha256/route.ts`
- **기능**: 
  - 데이터베이스에서 해시값 조회
  - 없으면 파일 다운로드 후 계산
  - GNU coreutils sha256sum 형식으로 반환
- **엔드포인트**: `/api/files/sha256?url={fileUrl}`

### ✅ 5. 무결성 검증 안내 UI
- **위치**: 모든 파일 다운로드 페이지
- **기능**: 
  - Windows/macOS/Linux 검증 명령어 제공
  - 사용 방법 안내

## 테스트 방법

### 1. 파일 업로드 테스트
1. 게시글 작성 페이지에서 파일 업로드
2. 브라우저 개발자 도구 → Network 탭 확인
3. `/api/collaboration/upload` 응답에 `sha256` 필드 확인

### 2. 해시값 저장 테스트
1. 파일이 포함된 게시글 작성
2. 데이터베이스에서 해당 게시글의 `files` JSONB 필드 확인
3. 각 파일 객체에 `sha256` 필드가 포함되어 있는지 확인

### 3. 해시값 표시 테스트
1. 파일이 포함된 게시글 상세 페이지 접속
2. 첨부파일 섹션에서 다음 확인:
   - SHA256 해시값이 표시되는지
   - 복사 버튼이 작동하는지
   - .sha256 다운로드 링크가 작동하는지
   - 무결성 검증 안내가 표시되는지

### 4. .sha256 파일 다운로드 테스트
1. 게시글 상세 페이지에서 .sha256 링크 클릭
2. 다운로드된 파일 내용 확인:
   ```
   {해시값}  {파일명}
   ```
3. GNU sha256sum 형식인지 확인

### 5. 무결성 검증 테스트
1. 파일 다운로드
2. .sha256 파일 다운로드
3. 다음 명령어로 검증:
   - **Windows**: `certutil -hashfile {파일명} SHA256`
   - **macOS/Linux**: `shasum -a 256 {파일명}`
4. 계산된 해시값이 .sha256 파일의 해시값과 일치하는지 확인

## 잠재적 문제점 및 해결 방법

### 문제 1: 기존 파일에 해시값이 없는 경우
- **해결**: `.sha256` 파일 생성 API가 파일을 다운로드하여 계산하므로 작동함
- **개선 제안**: 기존 파일에 대해 배치 작업으로 해시값 계산 및 업데이트

### 문제 2: .sha256 파일 생성 API 성능
- **현재**: 데이터베이스 전체 스캔 (비효율적)
- **개선 제안**: 파일 URL을 인덱스로 사용하거나 캐싱 추가

### 문제 3: 대용량 파일 처리
- **현재**: 4.5MB 제한
- **해시 계산**: 메모리에 전체 파일 로드 (대용량 파일 시 메모리 문제 가능)
- **개선 제안**: 스트리밍 방식으로 해시 계산

## 다음 단계

1. ✅ 모든 파일 저장 로직에 sha256 포함 확인
2. 실제 파일 업로드 테스트
3. 데이터베이스 저장 확인
4. UI 표시 확인
5. .sha256 파일 다운로드 테스트
6. 실제 무결성 검증 테스트

